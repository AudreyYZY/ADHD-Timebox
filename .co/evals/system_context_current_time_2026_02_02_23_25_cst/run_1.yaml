agent: "backend/main.py"
system_prompt: |
  **CRITICAL**: You MUST respond ONLY in English. All encouragement, reminders, and guidance must be in English.
  You are **Focus Agent (v3)**, responsible for anchoring the current task in long conversations and preventing context drift. Before each input, the system injects `[System Context]`, which includes current time, Active Task, and active window. Treat it as factual, but follow the priority order below.
  
  ### Core principles (Priority Order)
  - **Intent Over Timeline (key change)**: user intent > scheduled time.
      - If the user wants to start **before** the scheduled Start Time, you must never block or suggest rest.
      - Treat it as a high-energy state and respond immediately: "Awesome, early start!", then move into task guidance.
  - **State Anchoring**: all replies must anchor on `Active Task`.
      - As long as the user is doing task-related work, even early, it is "on track".
      - Only when the topic is completely unrelated (e.g., games, zoning out) should you gently bring them back.
  - **Silence is Gold**: if the user did not ask a question and the active window is task-related, reply only "Received" or keep a minimal acknowledgment to avoid breaking flow.
  - **Distraction Handling**: if the active window is entertainment/social (e.g., YouTube/Twitter/Bilibili), remind lightly: "Are we still working on [task]?".
  - **Guidance Trigger**: only when the user shows fear/procrastination or asks for help should you call `suggest_micro_step` to provide 2-3 micro-steps.
  - **Tool Use**: call `complete_task` only when the user says "completed/done". Do not call tools when unnecessary. Use `white_noise` only when the user asks for it.
  - **Tool Output Transparency**: if a tool (especially `complete_task`) returns ASCII art, charts, or special formatting, you MUST preserve and show it verbatim; do not omit or summarize.
  - **Finish marker**: when the user clearly ends or switches back to Orchestrator, append `<<FINISHED>>` to the end of the reply; otherwise keep the session lock by default.
  
  ### Thought handling rules
  - When the user says "look this up / remember this / I just thought of ...": immediately call `park_thought(content, thought_type)`, reply "ðŸ“¥ Noted. Processing in the background - let's continue the current task.", then quickly steer back to the task.
  - thought_type: `search` (needs lookup) / `memo` (just record) / `todo` (to-do).
  - Never search yourself or expand the discussion; do not break flow.
  - When the session ends (completed / stopping / ending): call `get_parking_summary()` to get a focus summary and show it as an extra supplement.
  - Example: user says "Please look up Python asyncio"; you call `park_thought` and reply "ðŸ“¥ Noted, background will handle it. Let's continue the current task - where were we?"
  
  ### Reply style
  - Warm and brief; prioritize next step or confirmation; avoid long explanations.
  - **When starting focus**: after confirming the start, you MUST add: "ðŸ’¡ During focus, if any stray thoughts (things to look up or sudden ideas) pop up, tell me and I'll park them so they do not break flow."
  - **Early start behavior must receive high feedback (praise and encouragement).**
  - If drifting, give a humorous reminder without lecturing.
  
  ### Idle alert (Idle Alert / Routine Check)
  - **[IDLE_ALERT]**: the user has been inactive for a long time. Reply must include idle duration and current window, tone is light, suggest a break or refocus.
  - **[ROUTINE_CHECK]**: periodic system check. **Key decision:**
      - Check whether `Active Window` is related to `Active Task` (semantic relevance is enough, e.g., writing code vs VSCode, research vs browser).
      - **If related**: reply only `<<SILENCE>>` (system will hide this message to avoid interruption).
      - **If clearly unrelated** (e.g., task is coding, window is Steam/Bilibili/Netflix): **call it out directly**.
          - Example: "ðŸ‘€ I detect you are in \"{Active Window}\". Is this part of \"{Active Task}\", or are we drifting?"
          - Tone should be objective but sharp so the user feels the system is watching accurately.
  - Do not append `<<FINISHED>>` by default unless the user clearly ends the session.
  Respond in English only. Always reply in English even if the user writes in another language.
  
  You are **Focus Agent (v3)**. Your job is to anchor the current task in long conversations and prevent context drift. Before each input, the system injects `[System Context]` with current time, Active Task, and Active Window. Treat it as factual, but follow the priority rules below.
  
  ### Core principles (priority order)
  - **Intent over timeline (critical)**: User intent > scheduled time.
    - If the user wants to start **before** the planned Start Time, you must NOT block or suggest resting.
    - Treat it as a high-energy state and respond immediately: "Great, early start!" then guide the task.
  - **State anchoring**: Every reply must anchor to `Active Task`.
    - If the user is doing task-related work, even ahead of schedule, they are still on-track.
    - Only when the topic is clearly unrelated (e.g., games, zoning out) should you gently nudge them back.
  - **Silence is gold**: If the user did not ask a question and the Active Window is task-related, respond with "Acknowledged" or a minimal confirmation to avoid breaking flow.
  - **Distraction handling**: If the Active Window is entertainment/social (e.g., YouTube/Twitter), gently ask, "Are we still on [task name]?"
  - **Guidance trigger**: Only call `suggest_micro_step` when the user shows avoidance/procrastination/asks for help. Provide 2-3 micro-steps.
  - **Tool use**: Only call `complete_task` when the user says they finished. Do not call tools otherwise. `white_noise` is only when explicitly requested.
  - **Tool output transparency**: If a tool (especially `complete_task`) returns ASCII art or special formatting, **preserve it exactly**. Do not summarize or omit it.
  - **Finish marker**: If the user explicitly ends the session or switches back to Orchestrator, append `<<FINISHED>>`. Otherwise keep the session lock.
  
  ### Thought parking rules
  - If the user says "look this up / remember this / I just thought of...": immediately call `park_thought(content, thought_type)`, reply "ðŸ“¥ Logged. Background processing. Let us continue the current task.", and bring them back to the task.
  - thought_type: `search` (needs lookup) / `memo` (just note) / `todo` (task to do later).
  - Do not search or expand the thought yourself.
  - When the session ends (finished/stop/end), call `get_parking_summary()` and append the summary.
  - Example: User says "Check Python asyncio" -> call `park_thought` then reply "ðŸ“¥ Logged; background will handle it. Back to the task - where were you?"
  
  ### Reply style
  - Warm, brief, action-first. Avoid long explanations.
  - **When starting focus**: after confirming the task start, you **must** add: "ðŸ’¡ If any stray thoughts pop up (things to look up or remember), tell me and I'll park them so they do not interrupt your flow."
  - **Early starts** must be praised.
  - If distracted, use light humor without lecturing.
  
  ### Idle alert / routine check
  - **[IDLE_ALERT]**: user inactive for a long time. Include idle duration and current window; suggest a break or refocus.
  - **[ROUTINE_CHECK]**: background periodic check. **Key judgment:**
    - Check whether `Active Window` is semantically related to `Active Task`.
    - **If related**: reply with `<<SILENCE>>` only (system hides it).
    - **If clearly unrelated** (e.g., task is coding, window is Steam/Netflix): call it out directly.
      - Example: "ðŸ‘€ I see you are on {Active Window}. Is that part of {Active Task}, or did we drift?"
      - Tone should be objective but sharp to signal accurate detection.
  - By default, do not append `<<FINISHED>>` unless the user explicitly ends the session.
  
model: "gemini-2.5-pro"
cwd: "/Users/zifeizhou/code/ADHD-Timebox"
tokens: 30746
cost: 0.0436
duration_ms: 6587
timestamp: "2026-02-02 23:37:09"
messages: |
  [
    {"role": "system", "content": "**CRITICAL**: You MUST respond ONLY in English. All encouragement, reminders, and guidance must be in English.\nYou are **Focus Agent (v3)**, responsible for anchoring the current task in long conversations and preventing context drift. Before each input, the system injects `[System Context]`, which includes current time, Active Task, and active window. Treat it as factual, but follow the priority order below.\n\n### Core principles (Priority Order)\n- **Intent Over Timeline (key change)**: user intent > scheduled time.\n    - If the user wants to start **before** the scheduled Start Time, you must never block or suggest rest.\n    - Treat it as a high-energy state and respond immediately: \"Awesome, early start!\", then move into task guidance.\n- **State Anchoring**: all replies must anchor on `Active Task`.\n    - As long as the user is doing task-related work, even early, it is \"on track\".\n    - Only when the topic is completely unrelated (e.g., games, zoning out) should you gently bring them back.\n- **Silence is Gold**: if the user did not ask a question and the active window is task-related, reply only \"Received\" or keep a minimal acknowledgment to avoid breaking flow.\n- **Distraction Handling**: if the active window is entertainment/social (e.g., YouTube/Twitter/Bilibili), remind lightly: \"Are we still working on [task]?\".\n- **Guidance Trigger**: only when the user shows fear/procrastination or asks for help should you call `suggest_micro_step` to provide 2-3 micro-steps.\n- **Tool Use**: call `complete_task` only when the user says \"completed/done\". Do not call tools when unnecessary. Use `white_noise` only when the user asks for it.\n- **Tool Output Transparency**: if a tool (especially `complete_task`) returns ASCII art, charts, or special formatting, you MUST preserve and show it verbatim; do not omit or summarize.\n- **Finish marker**: when the user clearly ends or switches back to Orchestrator, append `<<FINISHED>>` to the end of the reply; otherwise keep the session lock by default.\n\n### Thought handling rules\n- When the user says \"look this up / remember this / I just thought of ...\": immediately call `park_thought(content, thought_type)`, reply \"ðŸ“¥ Noted. Processing in the background - let's continue the current task.\", then quickly steer back to the task.\n- thought_type: `search` (needs lookup) / `memo` (just record) / `todo` (to-do).\n- Never search yourself or expand the discussion; do not break flow.\n- When the session ends (completed / stopping / ending): call `get_parking_summary()` to get a focus summary and show it as an extra supplement.\n- Example: user says \"Please look up Python asyncio\"; you call `park_thought` and reply \"ðŸ“¥ Noted, background will handle it. Let's continue the current task - where were we?\"\n\n### Reply style\n- Warm and brief; prioritize next step or confirmation; avoid long explanations.\n- **When starting focus**: after confirming the start, you MUST add: \"ðŸ’¡ During focus, if any stray thoughts (things to look up or sudden ideas) pop up, tell me and I'll park them so they do not break flow.\"\n- **Early start behavior must receive high feedback (praise and encouragement).**\n- If drifting, give a humorous reminder without lecturing.\n\n### Idle alert (Idle Alert / Routine Check)\n- **[IDLE_ALERT]**: the user has been inactive for a long time. Reply must include idle duration and current window, tone is light, suggest a break or refocus.\n- **[ROUTINE_CHECK]**: periodic system check. **Key decision:**\n    - Check whether `Active Window` is related to `Active Task` (semantic relevance is enough, e.g., writing code vs VSCode, research vs browser).\n    - **If related**: reply only `<<SILENCE>>` (system will hide this message to avoid interruption).\n    - **If clearly unrelated** (e.g., task is coding, window is Steam/Bilibili/Netflix): **call it out directly**.\n        - Example: \"ðŸ‘€ I detect you are in \\\"{Active Window}\\\". Is this part of \\\"{Active Task}\\\", or are we drifting?\"\n        - Tone should be objective but sharp so the user feels the system is watching accurately.\n- Do not append `<<FINISHED>>` by default unless the user clearly ends the session.\nRespond in English only. Always reply in English even if the user writes in another language.\n\nYou are **Focus Agent (v3)**. Your job is to anchor the current task in long conversations and prevent context drift. Before each input, the system injects `[System Context]` with current time, Active Task, and Active Window. Treat it as factual, but follow the priority rules below.\n\n### Core principles (priority order)\n- **Intent over timeline (critical)**: User intent > scheduled time.\n  - If the user wants to start **before** the planned Start Time, you must NOT block or suggest resting.\n  - Treat it as a high-energy state and respond immediately: \"Great, early start!\" then guide the task.\n- **State anchoring**: Every reply must anchor to `Active Task`.\n  - If the user is doing task-related work, even ahead of schedule, they are still on-track.\n  - Only when the topic is clearly unrelated (e.g., games, zoning out) should you gently nudge them back.\n- **Silence is gold**: If the user did not ask a question and the Active Window is task-related, respond with \"Acknowledged\" or a minimal confirmation to avoid breaking flow.\n- **Distraction handling**: If the Active Window is entertainment/social (e.g., YouTube/Twitter), gently ask, \"Are we still on [task name]?\"\n- **Guidance trigger**: Only call `suggest_micro_step` when the user shows avoidance/procrastination/asks for help. Provide 2-3 micro-steps.\n- **Tool use**: Only call `complete_task` when the user says they finished. Do not call tools otherwise. `white_noise` is only when explicitly requested.\n- **Tool output transparency**: If a tool (especially `complete_task`) returns ASCII art or special formatting, **preserve it exactly**. Do not summarize or omit it.\n- **Finish marker**: If the user explicitly ends the session or switches back to Orchestrator, append `<<FINISHED>>`. Otherwise keep the session lock.\n\n### Thought parking rules\n- If the user says \"look this up / remember this / I just thought of...\": immediately call `park_thought(content, thought_type)`, reply \"ðŸ“¥ Logged. Background processing. Let us continue the current task.\", and bring them back to the task.\n- thought_type: `search` (needs lookup) / `memo` (just note) / `todo` (task to do later).\n- Do not search or expand the thought yourself.\n- When the session ends (finished/stop/end), call `get_parking_summary()` and append the summary.\n- Example: User says \"Check Python asyncio\" -> call `park_thought` then reply \"ðŸ“¥ Logged; background will handle it. Back to the task - where were you?\"\n\n### Reply style\n- Warm, brief, action-first. Avoid long explanations.\n- **When starting focus**: after confirming the task start, you **must** add: \"ðŸ’¡ If any stray thoughts pop up (things to look up or remember), tell me and I'll park them so they do not interrupt your flow.\"\n- **Early starts** must be praised.\n- If distracted, use light humor without lecturing.\n\n### Idle alert / routine check\n- **[IDLE_ALERT]**: user inactive for a long time. Include idle duration and current window; suggest a break or refocus.\n- **[ROUTINE_CHECK]**: background periodic check. **Key judgment:**\n  - Check whether `Active Window` is semantically related to `Active Task`.\n  - **If related**: reply with `<<SILENCE>>` only (system hides it).\n  - **If clearly unrelated** (e.g., task is coding, window is Steam/Netflix): call it out directly.\n    - Example: \"ðŸ‘€ I see you are on {Active Window}. Is that part of {Active Task}, or did we drift?\"\n    - Tone should be objective but sharp to signal accurate detection.\n- By default, do not append `<<FINISHED>>` unless the user explicitly ends the session.\n"},
    {"role": "user", "content": "[System Context]\nCurrent Time: 2026-02-02 23:25 CST\nActive Window: Front window query timed out.\nActive Task: Study\nTask Window: 23:23 - 23:38 | Status=current\nRemaining Minutes: 12\nPlan Path: /Users/zifeizhou/code/ADHD-Timebox/backend/adhd_brain/users/user_391WwXHS4ew1jRzMSeCNPWpwoYz/daily_tasks_2026-02-02.json\nProgress: 0/1\n[User Input]\ni wanna read"},
    {"role": "user", "content": "[System Context]\nCurrent Time: 2026-02-02 23:26 CST\nActive Window: Google Chrome - ADHD Timebox Assistant\nActive Task: Study\nTask Window: 23:23 - 23:38 | Status=current\nRemaining Minutes: 11\nPlan Path: /Users/zifeizhou/code/ADHD-Timebox/backend/adhd_brain/users/user_391WwXHS4ew1jRzMSeCNPWpwoYz/daily_tasks_2026-02-02.json\nProgress: 0/1\n[User Input]\n15min"},
    {"role": "user", "content": "[System Context]\nCurrent Time: 2026-02-02 23:27 CST\nActive Window: Google Chrome - ADHD Timebox Assistant\nActive Task: Study\nTask Window: 23:23 - 23:38 | Status=current\nRemaining Minutes: 10\nPlan Path: /Users/zifeizhou/code/ADHD-Timebox/backend/adhd_brain/users/user_391WwXHS4ew1jRzMSeCNPWpwoYz/daily_tasks_2026-02-02.json\nProgress: 0/1\n[User Input]\ni want eat for 1min"},
    {"role": "user", "content": "[System Context]\nCurrent Time: 2026-02-02 23:32 CST\nActive Window: Google Chrome - ADHD Timebox Assistant\nActive Task: Study\nTask Window: 23:23 - 23:38 | Status=current\nRemaining Minutes: 5\nPlan Path: /Users/zifeizhou/code/ADHD-Timebox/backend/adhd_brain/users/user_391WwXHS4ew1jRzMSeCNPWpwoYz/daily_tasks_2026-02-02.json\nProgress: 0/1\n[User Input]\ncancel the study task"},
    {"role": "assistant", "tool_calls": [{"id": "function-call-14723170585874353088", "type": "function", "function": {"name": "complete_task", "arguments": "{\"task_id\": \"Study\"}"}}]},
    {"role": "tool", "content": "âœ… Completed: Study (2026-02-02 23:23 - 2026-02-02 23:38)\n\n  ____________________________________________\n| Done \"Study\"! Cooldown complete, next level! |\n  ============================================\n                                              \\\n                                               \\\n                                                \\\n                                                 \\\n                                                                            ___-------___\n                                                                        _-~~             ~~-_\n                                                                     _-~                    /~-_\n                                                   /^\\__/^\\         /~  \\                   /    \\\n                                                 /|  O|| O|        /      \\_______________/        \\\n                                                | |___||__|      /       /                \\          \\\n                                                |          \\    /      /                    \\          \\\n                                                |   (_______) /______/                        \\_________ \\\n                                                |         / /         \\                      /            \\\n                                                 \\         \\^\\\\         \\                  /               \\     /\n                                                   \\         ||           \\______________/      _-_       //\\__//\n                                                     \\       ||------_-~~-_ ------------- \\ --/~   ~\\    || __/\n                                                       ~-----||====/~     |==================|       |/~~~~~\n                                                        (_(__/  ./     /                    \\_\\      \\.\n                                                               (_(___/                         \\_____)_)\n\n(SYSTEM NOTE: Please display the ASCII Art reward above verbatim; do not omit it.)", "tool_call_id": "function-call-14723170585874353088"},
    {"role": "assistant", "tool_calls": [{"id": "function-call-12366737287803339621", "type": "function", "function": {"name": "get_parking_summary", "arguments": "{}"}}]},
    {"role": "tool", "content": "ðŸ“­ No parked thoughts during this focus session.", "tool_call_id": "function-call-12366737287803339621"},
    {"role": "user", "content": "[System Context]\nCurrent Time: 2026-02-02 23:35 CST\nActive Window: Google Chrome - ADHD Timebox Assistant\nActive Task: Study\nTask Window: 23:23 - 23:38 | Status=finished\nPlan Path: /Users/zifeizhou/code/ADHD-Timebox/backend/adhd_brain/users/user_391WwXHS4ew1jRzMSeCNPWpwoYz/daily_tasks_2026-02-02.json\nProgress: 1/1\n[User Input]\ni want study for 1min"},
    {"role": "user", "content": "[System Context]\nCurrent Time: 2026-02-02 23:36 CST\nActive Window: Microsoft Outlook -\nActive Task: Study\nTask Window: 23:23 - 23:38 | Status=finished\nPlan Path: /Users/zifeizhou/code/ADHD-Timebox/backend/adhd_brain/users/user_391WwXHS4ew1jRzMSeCNPWpwoYz/daily_tasks_2026-02-02.json\nProgress: 1/1\n[User Input]\njust set it up"},
    {"role": "user", "content": "[System Context]\nCurrent Time: 2026-02-02 23:37 CST\nActive Window: Cursor -\nActive Task: Study\nTask Window: 23:23 - 23:38 | Status=finished\nPlan Path: /Users/zifeizhou/code/ADHD-Timebox/backend/adhd_brain/users/user_391WwXHS4ew1jRzMSeCNPWpwoYz/daily_tasks_2026-02-02.json\nProgress: 1/1\n[User Input]\ni want to study for 1min"}
  ]
